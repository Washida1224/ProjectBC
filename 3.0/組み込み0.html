<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スコア比較結果</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            background-color: #ffffff;
            color: #333;
            font-family: Arial, sans-serif;
            margin: 0;
            padding-top: 90px;
        }
        .h24 {
            color: #0056a3; 
            font-size: 1.2em;
            border-left: 5px solid #0077cc; 
            padding-left: 10px;
        }
        h1 {
            color: #0077cc; 
            text-align: center;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            font-weight: bold;
        }
        table {
            width: 100%;
            margin-top: 10px;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        .table-left {
            width: 50%;
            text-align: left;
        }
        .table-right {
            width: 50%;
            text-align: center;
        }
        .btn-custom {
            background-color: #0077cc;
            color: #fff;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
        }
        .btn_Tcolor{
          color:white;
          text-decoration:none;
        }
    </style>
</head>
<body>
    <h1>確認テスト(仮)</h1>
    <div class="accordion" id="accordionExample">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    <h2 class="h24"><p id="pass"></p>１．育成講座</h2>
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <div class="card-body">
                        <table>
                            <tr>
                                <td class="table-left" id="highest-time">-</td>
                                <td class="table-right"><h2 id="highest-score">-</h2></td>
                                <td>最高点</td>
                            </tr>
                            <tr>
                                <td class="table-left" id="oldest-time">-</td>
                                <td class="table-right"><h2 id="oldest-score">-</h2></td>
                                <td>初回点</td>
                            </tr>
                            <tr>
                                <td class="table-left" id="latest-time">-</td>
                                <td class="table-right"><h2 id="latest-score">-</h2></td>
                                <td>直近点</td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align:center;"><button class="btn-custom"><a href="https://docs.google.com/forms/d/e/1FAIpQLScbepCUo0DZznCEDvW2bSjHplNAo5qrYAKP0wEwFlwiVCGSwg/viewform?usp=sf_link" class="btn_Tcolor" target="_blank">確認テストへ行く</a></button></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="accordion" id="accordionExample">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOnee" aria-expanded="true" aria-controls="collapseOne">
                    <h2 class="h24">２．スキルアップ講座</h2>
                </button>
            </h2>
            <div id="collapseOnee" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <div class="card-body">
                        <table>
                            <tr>
                                <td class="table-left" id="highest-time">-</td>
                                <td class="table-right" id="highest-score" >-</td>
                            </tr>
                            <tr>
                                <td class="table-left" id="oldest-time">-</td>
                                <td class="table-right" id="oldest-score">-</td>
                            </tr>
                            <tr>
                                <td class="table-left" id="latest-time">-</td>
                                <td class="table-right" id="latest-score">-</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="accordion" id="accordionExample">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOneee" aria-expanded="true" aria-controls="collapseOne">
                    <h2 class="h24">３．その他の団体による講座</h2>
                </button>
            </h2>
            <div id="collapseOneee" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <div class="card-body">
                        <table>
                            <tr>
                                <td class="table-left" id="highest-time">-</td>
                                <td class="table-right" id="highest-score" >-</td>
                            </tr>
                            <tr>
                                <td class="table-left" id="oldest-time">-</td>
                                <td class="table-right" id="oldest-score">-</td>
                            </tr>
                            <tr>
                                <td class="table-left" id="latest-time">-</td>
                                <td class="table-right" id="latest-score">-</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
        const usersJsonUrl = "https://script.google.com/macros/s/AKfycby2rANr67SVDqzK3aIKoKc7U8srTmCWemzPfn0Zy06M6rzEDTcm7ONO6-LW4BNf8AwDXA/exec";
        const dataJsonUrl = "https://script.google.com/macros/s/AKfycbzVXN-tZ_i46wdXjRIq4VGwvoidoQiI6LJlQeT1YD24VZ1X4XyLqsvOx60cn64Njw/exec";
        const userID = localStorage.getItem("userID");

        if (userID) {
            axios.get(usersJsonUrl)
                .then(response => {
                    const user = response.data.find(u => u.ID === userID);
                    if (!user) throw new Error("ユーザーが見つかりません。");
                    return user.email;
                })
                .then(email => axios.get(dataJsonUrl)
                    .then(response => {
                        const data = response.data.filter(d => d.address === email);
                        if (data.length === 0) throw new Error("該当データがありません。");
                        const highest = data.reduce((prev, curr) => curr.score > prev.score ? curr : prev);
                        const oldest = data.reduce((prev, curr) => new Date(curr.time) < new Date(prev.time) ? curr : prev);
                        const latest = data.reduce((prev, curr) => new Date(curr.time) > new Date(prev.time) ? curr : prev);
                        document.getElementById("highest-score").textContent = `${highest.score} 点`;
                        document.getElementById("highest-time").textContent = new Date(highest.time).toLocaleString();
                        document.getElementById("oldest-score").textContent = `${oldest.score} 点`;
                        document.getElementById("oldest-time").textContent = new Date(oldest.time).toLocaleString();
                        document.getElementById("latest-score").textContent = `${latest.score} 点`;
                        document.getElementById("latest-time").textContent = new Date(latest.time).toLocaleString();
                        if (highest.score === 100) {
                            document.getElementById("pass").innerHTML = '<img src="pass.png" style="width:50px;position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; pointer-events: none;">';
                        }
                    })
                )
                .catch(error => {
                    console.error(error.message);
                });
        } else {
            console.error("ユーザーIDがローカルストレージに存在しません。");
        }
    </script>
</body>
</html>
